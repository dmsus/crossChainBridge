.PHONY: benchmark analyze setup

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è performance —Ç–µ—Å—Ç–æ–≤
setup:
	@echo "üîß Setting up performance testing environment..."
	docker cp ../scripts/performance/db-analysis-fixed.sql test-postgres:/tmp/
	docker cp ../scripts/performance/add-performance-indexes.sql test-postgres:/tmp/
	docker exec test-postgres psql -U bridge_user -d bridge_local -c "CREATE EXTENSION IF NOT EXISTS pg_stat_statements;"

# –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –ë–î
analyze:
	@echo "üìä Analyzing database performance..."
	docker exec test-postgres psql -U bridge_user -d bridge_local -f /tmp/db-analysis-fixed.sql

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ performance –∏–Ω–¥–µ–∫—Å–æ–≤
indexes:
	@echo "‚ö° Adding performance indexes..."
	docker exec test-postgres psql -U bridge_user -d bridge_local -f /tmp/add-performance-indexes.sql

# –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–∞
benchmark:
	@echo "üöÄ Running performance benchmark..."
	cd .. && go run tests/performance/run_benchmark.go

# –ü–æ–ª–Ω—ã–π performance —Ç–µ—Å—Ç
all: setup indexes analyze benchmark
